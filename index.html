<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Raj ROOM'S - Admin Panel</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* --- STYLES (UNCHANGED) --- */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }
        body { background-color: #f1f5f9; color: #1e293b; }

        /* Login */
        #admin-login { height: 100vh; display: flex; justify-content: center; align-items: center; background: white; }
        .login-box { width: 350px; padding: 30px; border-radius: 12px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); border: 1px solid #e2e8f0; text-align: center; }
        .inp { width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #ccc; border-radius: 6px; }
        .btn { width: 100%; padding: 10px; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; color: white; transition: 0.3s; }
        .btn-red { background: #ef4444; } .btn-red:hover { background: #dc2626; }
        .btn-blue { background: #2563eb; } .btn-blue:hover { background: #1d4ed8; }
        .btn-warn { background: #f59e0b; } .btn-warn:hover { background: #d97706; }

        /* Dashboard */
        #dashboard { display: none; padding: 20px; max-width: 1200px; margin: 0 auto; }
        .header { display: flex; justify-content: space-between; align-items: center; background: white; padding: 20px; border-radius: 10px; margin-bottom: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        
        /* Stats */
        .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 20px; }
        .stat-card { background: white; padding: 20px; border-radius: 10px; text-align: center; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .stat-num { font-size: 2rem; font-weight: 700; color: #2563eb; margin-bottom:5px; }
        
        /* Tabs */
        .tabs { display: flex; gap: 10px; margin-bottom: 15px; }
        .tab-btn { padding: 10px 20px; border: none; background: #e2e8f0; border-radius: 8px; cursor: pointer; font-weight: 600; color: #64748b; }
        .tab-btn.active { background: #2563eb; color: white; }
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity:0; transform:translateY(5px); } to { opacity:1; transform:translateY(0); } }

        /* Tables */
        .table-container { background: white; border-radius: 10px; padding: 15px; overflow-x: auto; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        table { width: 100%; border-collapse: collapse; min-width: 700px; }
        th, td { text-align: left; padding: 12px; border-bottom: 1px solid #e2e8f0; }
        th { background: #f8fafc; color: #64748b; }
        .img-thumb { width: 50px; height: 50px; object-fit: cover; border-radius: 5px; }
        .actions { display: flex; gap: 5px; }
        .action-btn { padding: 6px 12px; border: none; border-radius: 4px; color: white; cursor: pointer; font-size: 12px; }

        /* Modal */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 2000; justify-content: center; align-items: center; }
        .modal-box { background: white; padding: 25px; border-radius: 10px; width: 400px; }
        .modal-box label { display: block; font-size: 12px; font-weight: bold; margin-top: 10px; color: #64748b; }
    </style>
</head>
<body>

    <!-- Login -->
    <div id="admin-login">
        <div class="login-box">
            <h2 style="color:#ef4444; margin-bottom:20px;">Admin Panel</h2>
            <input type="text" id="a-user" class="inp" placeholder="Username (admin)">
            <input type="password" id="a-pass" class="inp" placeholder="Password (admin123)">
            <button class="btn btn-red" onclick="login()">Login</button>
        </div>
    </div>

    <!-- Dashboard -->
    <div id="dashboard">
        <div class="header">
            <h3>Admin Dashboard <span style="font-size:12px; color:green; margin-left:10px;">● Live Connected</span></h3>
            <button class="btn btn-red" style="width: auto;" onclick="logout()">Logout</button>
        </div>

        <div class="stats">
            <div class="stat-card">
                <div class="stat-num" id="total-rooms">0</div>
                <div style="color:#64748b; font-size:0.9rem;">Total Rooms</div>
            </div>
            <div class="stat-card">
                <div class="stat-num" id="total-users" style="color:#f59e0b;">0</div>
                <div style="color:#64748b; font-size:0.9rem;">Registered Users</div>
            </div>
            <div class="stat-card">
                <div class="stat-num" id="total-val" style="color:#22c55e;">₹0</div>
                <div style="color:#64748b; font-size:0.9rem;">Total Value</div>
            </div>
        </div>

        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('view-rooms', this)">Manage Rooms</button>
            <button class="tab-btn" onclick="switchTab('view-users', this)">Manage Users</button>
        </div>

        <!-- Rooms Table -->
        <div id="view-rooms" class="tab-content active">
            <div class="table-container">
                <h4 style="margin-bottom:15px;">All Posted Rooms</h4>
                <table>
                    <thead>
                        <tr>
                            <th>Image</th>
                            <th>Owner</th>
                            <th>Details</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="rooms-body"></tbody>
                </table>
            </div>
        </div>

        <!-- Users Table -->
        <div id="view-users" class="tab-content">
            <div class="table-container">
                <h4 style="margin-bottom:15px;">Registered Users</h4>
                <table>
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Mobile</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="users-body"></tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Edit Modal -->
    <div id="edit-modal" class="modal">
        <div class="modal-box">
            <h3>Edit Room</h3>
            <input type="hidden" id="e-id">
            <label>Price (₹)</label><input type="number" id="e-price" class="inp">
            <label>Address</label><input type="text" id="e-addr" class="inp">
            <div style="display:flex; gap:10px; margin-top:15px;">
                <button class="btn btn-blue" onclick="saveEdit()">Save</button>
                <button class="btn" style="background:#94a3b8;" onclick="closeModal()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- FIREBASE SCRIPT -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getDatabase, ref, onValue, remove, update } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js";

        // --- YOUR PROVIDED FIREBASE KEYS ---
        const firebaseConfig = {
          apiKey: "AIzaSyACyhDCsfJ23x1hJ1njzkvrEmRVTN1HZ78",
          authDomain: "rooms-20b62.firebaseapp.com",
          databaseURL: "https://rooms-20b62-default-rtdb.firebaseio.com",
          projectId: "rooms-20b62",
          storageBucket: "rooms-20b62.firebasestorage.app",
          messagingSenderId: "108894681696",
          appId: "1:108894681696:web:1398f3749ac3c502f26105",
          measurementId: "G-VS0FESKZVH"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        let rooms = [];
        let users = [];

        // --- FIREBASE LISTENERS (Global Sync) ---
        
        // Sync Rooms
        onValue(ref(db, 'rooms'), (snapshot) => {
            const data = snapshot.val();
            rooms = data ? Object.entries(data).map(([key, val]) => ({ id: key, ...val })).reverse() : [];
            if(document.getElementById('dashboard').style.display === 'block') {
                refreshData();
            }
        });

        // Sync Users
        onValue(ref(db, 'users'), (snapshot) => {
            const data = snapshot.val();
            // Users are stored by mobile number key, converting to array
            users = data ? Object.values(data) : [];
            if(document.getElementById('dashboard').style.display === 'block') {
                refreshData();
            }
        });

        // --- GLOBAL FUNCTIONS FOR HTML ONCLICK ---

        window.login = () => {
            if(document.getElementById('a-user').value === 'admin' && document.getElementById('a-pass').value === 'admin123') {
                document.getElementById('admin-login').style.display = 'none';
                document.getElementById('dashboard').style.display = 'block';
                refreshData();
            } else { alert("Invalid Credentials!"); }
        };

        window.refreshData = () => {
            document.getElementById('total-rooms').innerText = rooms.length;
            document.getElementById('total-users').innerText = users.length;
            document.getElementById('total-val').innerText = '₹' + rooms.reduce((a,c) => a+Number(c.price), 0).toLocaleString();
            
            renderRooms();
            renderUsers();
        };

        window.switchTab = (id, btn) => {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
        };

        function renderRooms() {
            const tbody = document.getElementById('rooms-body');
            tbody.innerHTML = rooms.length ? '' : '<tr><td colspan="5" style="text-align:center; padding:20px;">No rooms found.</td></tr>';
            
            rooms.forEach(r => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td><img src="${r.image}" class="img-thumb"></td>
                    <td><b>${r.name}</b><br><small>${r.mobile}</small></td>
                    <td><b>₹${r.price}</b><br><small>${r.address}</small><br>
                        <span style="font-size:10px; background:#e0f2fe; padding:2px 5px; border-radius:3px;">${r.type || 'Room'}</span>
                    </td>
                    <td><span style="padding:4px 8px; border-radius:4px; font-size:12px; background:${r.hidden ? '#fef08a':'#bbf7d0'}; color:${r.hidden ? '#854d0e':'#166534'}">${r.hidden ? 'Hidden':'Active'}</span></td>
                    <td class="actions">
                        <button class="action-btn btn-warn" onclick="openEdit('${r.id}')"><i class="fa-solid fa-pen"></i></button>
                        <button class="action-btn btn-blue" onclick="toggleHide('${r.id}', ${r.hidden})"><i class="fa-solid fa-eye${r.hidden?'':'-slash'}"></i></button>
                        <button class="action-btn btn-red" onclick="deleteRoom('${r.id}')"><i class="fa-solid fa-trash"></i></button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        window.deleteRoom = (id) => {
            if(confirm("Permanently delete this room?")) {
                remove(ref(db, 'rooms/' + id));
            }
        };

        window.toggleHide = (id, currentStatus) => {
            update(ref(db, 'rooms/' + id), { hidden: !currentStatus });
        };

        window.openEdit = (id) => {
            const r = rooms.find(x => x.id === id);
            document.getElementById('e-id').value = r.id;
            document.getElementById('e-price').value = r.price;
            document.getElementById('e-addr').value = r.address;
            document.getElementById('edit-modal').style.display = 'flex';
        };

        window.saveEdit = () => {
            const id = document.getElementById('e-id').value;
            const updates = {
                price: document.getElementById('e-price').value,
                address: document.getElementById('e-addr').value
            };
            update(ref(db, 'rooms/' + id), updates);
            window.closeModal();
        };

        window.closeModal = () => { document.getElementById('edit-modal').style.display = 'none'; };

        function renderUsers() {
            const tbody = document.getElementById('users-body');
            tbody.innerHTML = users.length ? '' : '<tr><td colspan="3" style="text-align:center; padding:20px;">No users registered.</td></tr>';

            users.forEach(u => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td><b>${u.name}</b></td>
                    <td>${u.mobile}</td>
                    <td><button class="action-btn btn-red" onclick="deleteUser('${u.mobile}')"><i class="fa-solid fa-trash"></i> Delete</button></td>
                `;
                tbody.appendChild(tr);
            });
        }

        window.deleteUser = (mobileId) => {
            if(confirm("Delete this user?")) {
                // In this structure, users are stored by mobile number as key
                remove(ref(db, 'users/' + mobileId));
            }
        };

        window.logout = () => {
            location.reload();
        };
    </script>
</body>
</html>
